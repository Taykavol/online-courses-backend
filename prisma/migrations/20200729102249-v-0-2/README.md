# Migration `20200729102249-v-0-2`

This migration has been generated by Taykavol at 7/29/2020, 10:22:49 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Chapter" DROP CONSTRAINT "Chapter_courseID_fkey"

CREATE TABLE "public"."Curriculum" (
"id" SERIAL,
"courseID" integer  NOT NULL ,
PRIMARY KEY ("id"))

ALTER TABLE "public"."Chapter" DROP COLUMN "courseID",
ADD COLUMN "curriculumID" integer  NOT NULL ;

CREATE UNIQUE INDEX "Curriculum_courseID" ON "public"."Curriculum"("courseID")

ALTER TABLE "public"."Curriculum" ADD FOREIGN KEY ("courseID")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Chapter" ADD FOREIGN KEY ("curriculumID")REFERENCES "public"."Curriculum"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200728203137-0-1..20200729102249-v-0-2
--- datamodel.dml
+++ datamodel.dml
@@ -2,30 +2,15 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
-// model Post {
-//   id        Int      @default(autoincrement()) @id
-//   createdAt DateTime @default(now())
-//   title     String
-//   content   String?
-//   published Boolean  @default(false)
-//   author    User     @relation(fields: [authorId], references: [id])
-//   authorId  Int
-// }
-// model Profile {
-//   id     Int     @default(autoincrement()) @id
-//   bio    String?
-//   user   User    @relation(fields: [userId], references: [id])
-//   userId Int     @unique
-// }
 model User {
   id      Int      @default(autoincrement()) @id
   role Role @default(USER)
   email   String   @unique
@@ -64,20 +49,27 @@
 price Float @default(9.99)
 priceSale Float @default(9.99)
 picture String?
 averageRating Float @default(0)
-curriculum Chapter[]
+curriculum Curriculum?
 comments Comment[]
 totalPurchase Int @default(0)
 totalRevenue Float @default(0)
 forSearchEngines Float @default(0)
 createdAt DateTime @default(now()) 
 }
-model Chapter {
+model Curriculum {
 id Int @default(autoincrement()) @id
 course Course @relation(fields: [courseID],references:[id])
 courseID Int
+chapters Chapter[] 
+}
+
+model Chapter {
+id Int @default(autoincrement()) @id
+curriculum Curriculum @relation(fields: [curriculumID],references:[id])
+curriculumID Int
 order Int
 name String
 lessons Lesson[]
 }
@@ -139,89 +131,4 @@
   USER
 }
-
-// type Puzzle = {
-// id:ID, 
-// lesson:ID,
-// order:Interger,
-// description:String,
-// fen:String!,
-// moves:[{move:"",comment:""}]!
-// }
-// type Video = {
-// id:ID
-// vimeoID: Integer,
-// lesson:ID
-// }
-
-
-// type Lesson = {
-// id:ID,
-// order:Integer,
-// name:String,
-// chapter:ID, 
-// video:ID
-// puzzles:[Puzzle)]
-// }
-
-// type Chapter = {
-// id:ID,
-// order:Integer, 
-// name:String,
-// lessons:[Lesson],
-// }
-// type Comment = {
-// id:ID,
-// author:User,
-// title:String,
-// text:String,
-// reply: Comment
-// }
-// type Course = {
-// id:ID,
-// name:String,
-// description:String,
-// category:String,
-// level:String, 
-// status:enum["Building","verifying","publish"]
-// author:ID (user),
-// students:[ID], 
-// price:float,
-// priceSale:float,
-// whyChooseCourse:[String],
-// picture:URL,
-// curriculum:[Chapter],
-// averageRating: Integer [0-5],
-// comments:[{comment:String, rating:[0-5]}, reply:String]],
-// totalPurchase: Integer,
-// forSearchEngine: float,
-// createdAt:Date,  
-// totalRevenue:float
-// }
-
-
-
-
-
-// type User =  {
-// id:ID, 
-// name:String,
-// username:String!,
-// email:String!,
-// lichessID:"",
-// googleAuth:"",
-// facebookAuth:"",
-// aboutMe:String,
-// title:enum ["GM","IM","FM", "WGM", "WIM"],
-// myCourses:[Course],
-// boughtCourses:[Course],
-// comments:[],
-// banned:Boolean, 
-// role: enum ["admininstrator","teacher+","teacher","student"]!,
-
-// Student = registed user, Teacher = student + title 
-// Teacher+ = Teacher+"PayPal", Admin=god 
-
-// %: Integer,
-// }
```


