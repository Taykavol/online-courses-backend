# Migration `20200819221308-added-order`

This migration has been generated by Taykavol at 8/20/2020, 1:13:08 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."_CourseToUser" DROP CONSTRAINT "_CourseToUser_A_fkey"

ALTER TABLE "public"."_CourseToUser" DROP CONSTRAINT "_CourseToUser_B_fkey"

CREATE TABLE "public"."BoughtCourse" (
"id" SERIAL,
"userId" integer   ,
"orderId" integer   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Order" (
"id" SERIAL,
"price" Decimal(65,30)  NOT NULL ,
PRIMARY KEY ("id"))

ALTER TABLE "public"."User" ADD COLUMN "courseId" integer   ;

CREATE UNIQUE INDEX "BoughtCourse_orderId" ON "public"."BoughtCourse"("orderId")

ALTER TABLE "public"."BoughtCourse" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."BoughtCourse" ADD FOREIGN KEY ("orderId")REFERENCES "public"."Order"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."_CourseToUser";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200819163200-added-role-teacher..20200819221308-added-order
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -15,9 +15,9 @@
   role Role @default(USER)
   email   String?   @unique
   password String?
   lichessId String? @unique
-  boughtCourses Course[] @relation(references: [id])
+  boughtCourses BoughtCourse[] 
   isBanned Boolean @default(false)
   instructorProfile instructorProfile? 
 }
 model instructorProfile{
@@ -28,8 +28,20 @@
   title Title?
   myCourses Course[]
   // paypalId String?
 }
+model BoughtCourse {
+  id Int @default(autoincrement()) @id
+  user User? @relation(fields: [userId],references:[id])
+  userId Int?
+  order Order? @relation(fields: [orderId],references:[id])
+  orderId Int?
+}
+model Order {
+  id Int @default(autoincrement()) @id
+  price Float
+  course BoughtCourse
+}
 model Course {
 id Int @default(autoincrement()) @id
 title String @default("")
@@ -39,9 +51,9 @@
 description String? @default("")
 category Category @default(Basics)
 level String @default("1500 2000")
 status Status? @default(BUILDING)
-registedStudents User[] @relation(references: [id])
+registedStudents User[] 
 lessons Int?
 duration Int?
 price Float @default(20)
 // picture String?
```


