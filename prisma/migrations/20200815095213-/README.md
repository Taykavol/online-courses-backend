# Migration `20200815095213-`

This migration has been generated by Taykavol at 8/15/2020, 12:52:13 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."User.lichessID"

DROP INDEX "public"."instructorProfile_userID"

ALTER TABLE "public"."Chapter" DROP CONSTRAINT "Chapter_curriculumID_fkey"

ALTER TABLE "public"."Comment" DROP CONSTRAINT "Comment_courseID_fkey"

ALTER TABLE "public"."Comment" DROP CONSTRAINT "Comment_userID_fkey"

ALTER TABLE "public"."Curriculum" DROP CONSTRAINT "Curriculum_courseID_fkey"

ALTER TABLE "public"."Lesson" DROP CONSTRAINT "Lesson_chapterID_fkey"

ALTER TABLE "public"."Puzzle" DROP CONSTRAINT "Puzzle_lessonID_fkey"

ALTER TABLE "public"."Video" DROP CONSTRAINT "Video_lessonID_fkey"

ALTER TABLE "public"."Course" DROP CONSTRAINT "Course_authorID_fkey"

ALTER TABLE "public"."instructorProfile" DROP CONSTRAINT "instructorProfile_userID_fkey"

ALTER TABLE "public"."Course" DROP COLUMN "authorID",
DROP COLUMN "price",
DROP COLUMN "priceSale",
DROP COLUMN "picture",
DROP COLUMN "averageRating",
DROP COLUMN "totalPurchase",
DROP COLUMN "totalRevenue",
DROP COLUMN "forSearchEngines",
ADD COLUMN "authorId" integer   ,
ADD COLUMN "curriculum" jsonb   ,
ALTER COLUMN "name" SET DEFAULT E'',
ALTER COLUMN "description" SET DEFAULT E'';

ALTER TABLE "public"."User" DROP COLUMN "publicName",
DROP COLUMN "lichessID",
DROP COLUMN "googleID",
DROP COLUMN "facebookID",
DROP COLUMN "banned",
ADD COLUMN "lichessId" text   ,
ADD COLUMN "isBanned" boolean  NOT NULL DEFAULT false;

ALTER TABLE "public"."instructorProfile" DROP COLUMN "userID",
DROP COLUMN "paypalID",
DROP COLUMN "bitcoinAdress",
DROP COLUMN "income",
ADD COLUMN "userId" integer   ;

CREATE UNIQUE INDEX "User.lichessId_unique" ON "public"."User"("lichessId")

CREATE UNIQUE INDEX "instructorProfile_userId" ON "public"."instructorProfile"("userId")

ALTER TABLE "public"."Course" ADD FOREIGN KEY ("authorId")REFERENCES "public"."instructorProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."instructorProfile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."Chapter";

DROP TABLE "public"."Comment";

DROP TABLE "public"."Curriculum";

DROP TABLE "public"."Lesson";

DROP TABLE "public"."Puzzle";

DROP TABLE "public"."Video";

ALTER INDEX "public"."User.email" RENAME TO "User.email_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200813170212-email-custom..20200815095213-
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -14,104 +14,96 @@
   id      Int      @default(autoincrement()) @id
   role Role @default(USER)
   email   String?   @unique
   password String?
-  publicName    String?
-  lichessID String? @unique
-  googleID String?
-  facebookID String?
+  lichessId String? @unique
   boughtCourses Course[] @relation(references: [id])
-  banned Boolean? @default(false)
-  // posts   Post[]
+  isBanned Boolean @default(false)
   instructorProfile instructorProfile? 
 }
 model instructorProfile{
-id Int @default(autoincrement()) @id
-user User @relation(fields: [userID],references:[id])
-userID Int
-teacherName String?
-title Title?
-myCourses Course[]
-paypalID String?
-bitcoinAdress String?
-income Int?
+  id Int @default(autoincrement()) @id
+  user User? @relation(fields: [userId],references:[id])
+  userId Int?
+  teacherName String?
+  title Title?
+  myCourses Course[]
+  // paypalId String?
 }
 model Course {
 id Int @default(autoincrement()) @id
-name String? @default("My new course")
-author instructorProfile @relation(fields: [authorID],references:[id])
-authorID Int
-description String?
+name String? @default("")
+author instructorProfile? @relation(fields: [authorId],references:[id])
+authorId Int?
+description String? @default("")
 category String?
 level String?
 status Status? @default(BUILDING)
 registedStudents User[] @relation(references: [id])
-price Float @default(9.99)
-priceSale Float @default(9.99)
-picture String?
-averageRating Float @default(0)
-curriculum Curriculum?
-comments Comment[]
-totalPurchase Int @default(0)
-totalRevenue Float @default(0)
-forSearchEngines Float @default(0)
+// price Float @default(9.99)
+// picture String?
+// averageRating Float @default(0)
+curriculum Json?
+// totalPurchase Int @default(0)
+// totalRevenue Float @default(0)
+// forSearchEngines Float @default(0)
 createdAt DateTime @default(now()) 
 }
-model Curriculum {
-id Int @default(autoincrement()) @id
-course Course? @relation(fields: [courseID],references:[id])
-courseID Int?
-chapters Chapter[] 
-}
+// model Curriculum {
+// id Int @default(autoincrement()) @id
+// course Course? @relation(fields: [courseId],references:[id])
+// courseId Int?
+// chapters Chapter[] 
+// }
-model Chapter {
-id Int @default(autoincrement()) @id
-curriculum Curriculum @relation(fields: [curriculumID],references:[id])
-curriculumID Int
-order Int
-name String?
-lessons Lesson[]
-}
+// model Chapter {
+// id Int @default(autoincrement()) @id
+// curriculum Curriculum @relation(fields: [curriculumID],references:[id])
+// curriculumID Int
+// order Int
+// name String?
+// lessons Lesson[]
+// }
-model Comment {
-id Int @default(autoincrement()) @id
-user User @relation(fields: [userID],references:[id])
-userID Int
-course Course @relation(fields: [courseID],references:[id])
-courseID Int
-title String
-text String
-}
+// model Comment {
+// id Int @default(autoincrement()) @id
+// user User @relation(fields: [userID],references:[id])
+// userID Int
+// course Course @relation(fields: [courseID],references:[id])
+// courseID Int
+// title String
+// text String
+// }
-model Lesson {
-id Int @default(autoincrement()) @id
-order Int
-name String?
-chapter Chapter @relation(fields: [chapterID],references:[id])
-chapterID Int
-video Video?
-puzzles Puzzle[]
-}
+// model Lesson {
+// id Int @default(autoincrement()) @id
+// order Int
+// name String?
+// chapter Chapter @relation(fields: [chapterID],references:[id])
+// chapterID Int
+// video Video?
+// puzzles Puzzle[]
+// }
-model Video {
-id Int @default(autoincrement()) @id
-vimeoID Int
-duration Float
-lesson Lesson @relation(fields: [lessonID],references:[id])
-lessonID Int
-}
+// model Video {
+// id Int @default(autoincrement()) @id
+// vimeoID Int
+// duration Float
+// lesson Lesson @relation(fields: [lessonID],references:[id])
+// lessonID Int
+// }
-model Puzzle {
-  id Int @default(autoincrement()) @id
-  lesson Lesson @relation(fields: [lessonID],references:[id])
-  lessonID Int
-  description String?
-  fen String
-  moves String[]
-  helps String[]
-}
+// model Puzzle {
+//   id Int @default(autoincrement()) @id
+//   lesson Lesson @relation(fields: [lessonID],references:[id])
+//   lessonID Int
+//   description String?
+//   fen String
+//   moves String[]
+//   helps String[]
+// }
 enum Status {
 BUILDING
 VERIFYING
```


