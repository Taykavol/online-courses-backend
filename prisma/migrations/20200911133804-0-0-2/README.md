# Migration `20200911133804-0-0-2`

This migration has been generated by Taykavol at 9/11/2020, 4:38:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."User" DROP CONSTRAINT "User_courseId_fkey"

ALTER TABLE "public"."BoughtCourse" DROP COLUMN "review",
DROP COLUMN "reviewMessage"

ALTER TABLE "public"."User" DROP COLUMN "courseId"

CREATE TABLE "public"."Review" (
"id" SERIAL,
"boughtCourseId" integer   NOT NULL ,
"courseId" integer   NOT NULL ,
"review" integer   NOT NULL ,
"reviewMessage" text   ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Review_boughtCourseId_unique" ON "public"."Review"("boughtCourseId")

ALTER TABLE "public"."Review" ADD FOREIGN KEY ("boughtCourseId")REFERENCES "public"."BoughtCourse"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Review" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200910231846-0-0-2..20200911133804-0-0-2
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -38,10 +38,10 @@
   course Course @relation(fields: [courseId],references:[id])
   courseId Int
   progress Int @default(2)
   lastSeen DateTime @default(now())
-  review Float?
-  reviewMessage String?
+  review Review?
+  // reviewMessage String?
 }
 model Order {
   id Int @default(autoincrement()) @id
   price Float
@@ -64,22 +64,33 @@
 description String? @default("")
 category Category @default(Basics)
 level String @default("1500 2000")
 status Status? @default(BUILDING)
-registedStudents User[] 
+// registedStudents User[] 
 lessons Int?
 duration Int?
 price Float @default(20)
 // picture String?
 averageRating Float @default(0)
 numberReviews Int @default(0)
 curriculum String?
+reviews Review[]
 // totalPurchase Int @default(0)
 // totalRevenue Float @default(0)
 // forSearchEngines Float @default(0)
 createdAt DateTime @default(now()) 
 }
+model Review {
+  id Int @default(autoincrement()) @id
+  boughtCourse BoughtCourse @relation(fields: [boughtCourseId],references:[id])
+  boughtCourseId Int
+  course Course @relation(fields: [courseId],references:[id])
+  courseId Int
+  review Int 
+  reviewMessage String?
+}
+
 // model Curriculum {
 // id Int @default(autoincrement()) @id
 // course Course? @relation(fields: [courseId],references:[id])
 // courseId Int?
```


