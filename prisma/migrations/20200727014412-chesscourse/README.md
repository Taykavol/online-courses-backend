# Migration `20200727014412-chesscourse`

This migration has been generated by Taykavol at 7/27/2020, 1:44:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Status" AS ENUM ('BUILDING', 'VERIFYING', 'PUBLISH');

CREATE TYPE "Title" AS ENUM ('GM', 'IM', 'FM', 'WGM', 'WIM');

CREATE TYPE "Role" AS ENUM ('ADMIN', 'USER');

ALTER TABLE "public"."Post" DROP CONSTRAINT "Post_authorId_fkey"

ALTER TABLE "public"."Profile" DROP CONSTRAINT "Profile_userId_fkey"

CREATE TABLE "public"."instructorProfile" (
"id" SERIAL,
"userID" integer  NOT NULL ,
"teacherName" text   ,
"title" "Title"  ,
"paypalID" text   ,
"bitcoinAdress" text   ,
"income" integer   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Course" (
"id" SERIAL,
"name" text   ,
"authorID" integer  NOT NULL ,
"description" text   ,
"category" text   ,
"level" text   ,
"status" "Status"  DEFAULT E'BUILDING',
"price" Decimal(65,30)  NOT NULL DEFAULT 9.99,
"priceSale" Decimal(65,30)  NOT NULL DEFAULT 9.99,
"picture" text   ,
"averageRating" Decimal(65,30)  NOT NULL DEFAULT 0,
"totalPurchase" integer  NOT NULL ,
"totalRevenue" Decimal(65,30)  NOT NULL ,
"forSearchEngines" Decimal(65,30)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Chapter" (
"id" SERIAL,
"courseID" integer  NOT NULL ,
"order" integer  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"userID" integer  NOT NULL ,
"courseID" integer  NOT NULL ,
"title" text  NOT NULL ,
"text" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Lesson" (
"id" SERIAL,
"order" integer  NOT NULL ,
"name" text  NOT NULL ,
"chapterID" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Video" (
"id" SERIAL,
"vimeoID" integer  NOT NULL ,
"duration" Decimal(65,30)  NOT NULL ,
"lessonID" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Puzzle" (
"id" SERIAL,
"lessonID" integer  NOT NULL ,
"description" text   ,
"fen" text  NOT NULL ,
"moves" text []  ,
"helps" text []  ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_CourseToUser" (
"A" integer  NOT NULL ,
"B" integer  NOT NULL )

ALTER TABLE "public"."User" DROP COLUMN "name",
ADD COLUMN "role" "Role" NOT NULL DEFAULT E'USER',
ADD COLUMN "publicName" text   ,
ADD COLUMN "lichessID" text   ,
ADD COLUMN "googleID" text   ,
ADD COLUMN "facebookID" text   ,
ADD COLUMN "banned" boolean   DEFAULT false;

CREATE UNIQUE INDEX "instructorProfile_userID" ON "public"."instructorProfile"("userID")

CREATE UNIQUE INDEX "Video_lessonID" ON "public"."Video"("lessonID")

CREATE UNIQUE INDEX "_CourseToUser_AB_unique" ON "public"."_CourseToUser"("A","B")

CREATE  INDEX "_CourseToUser_B_index" ON "public"."_CourseToUser"("B")

ALTER TABLE "public"."instructorProfile" ADD FOREIGN KEY ("userID")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Course" ADD FOREIGN KEY ("authorID")REFERENCES "public"."instructorProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Chapter" ADD FOREIGN KEY ("courseID")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userID")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("courseID")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Lesson" ADD FOREIGN KEY ("chapterID")REFERENCES "public"."Chapter"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Video" ADD FOREIGN KEY ("lessonID")REFERENCES "public"."Lesson"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Puzzle" ADD FOREIGN KEY ("lessonID")REFERENCES "public"."Lesson"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CourseToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CourseToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Post";

DROP TABLE "public"."Profile";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200723045336-added-password..20200727014412-chesscourse
--- datamodel.dml
+++ datamodel.dml
@@ -2,34 +2,225 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
-model Post {
-  id        Int      @default(autoincrement()) @id
-  createdAt DateTime @default(now())
-  title     String
-  content   String?
-  published Boolean  @default(false)
-  author    User     @relation(fields: [authorId], references: [id])
-  authorId  Int
-}
-model Profile {
-  id     Int     @default(autoincrement()) @id
-  bio    String?
-  user   User    @relation(fields: [userId], references: [id])
-  userId Int     @unique
-}
+// model Post {
+//   id        Int      @default(autoincrement()) @id
+//   createdAt DateTime @default(now())
+//   title     String
+//   content   String?
+//   published Boolean  @default(false)
+//   author    User     @relation(fields: [authorId], references: [id])
+//   authorId  Int
+// }
+// model Profile {
+//   id     Int     @default(autoincrement()) @id
+//   bio    String?
+//   user   User    @relation(fields: [userId], references: [id])
+//   userId Int     @unique
+// }
 model User {
   id      Int      @default(autoincrement()) @id
+  role Role @default(USER)
   email   String   @unique
   password String?
-  name    String?
-  posts   Post[]
-  profile Profile?
-}
+  publicName    String?
+  lichessID String?
+  googleID String?
+  facebookID String?
+  boughtCourses Course[] @relation(references: [id])
+  banned Boolean? @default(false)
+  // posts   Post[]
+  instructorProfile instructorProfile? 
+}
+model instructorProfile{
+id Int @default(autoincrement()) @id
+user User @relation(fields: [userID],references:[id])
+userID Int
+teacherName String?
+title Title?
+myCourses Course[]
+paypalID String?
+bitcoinAdress String?
+income Int?
+}
+
+model Course {
+id Int @default(autoincrement()) @id
+name String?
+author instructorProfile @relation(fields: [authorID],references:[id])
+authorID Int
+description String?
+category String?
+level String?
+status Status? @default(BUILDING)
+registedStudents User[] @relation(references: [id])
+price Float @default(9.99)
+priceSale Float @default(9.99)
+picture String?
+averageRating Float @default(0)
+curriculum Chapter[]
+comments Comment[]
+totalPurchase Int
+totalRevenue Float
+forSearchEngines Float
+createdAt DateTime @default(now()) 
+}
+
+model Chapter {
+id Int @default(autoincrement()) @id
+course Course @relation(fields: [courseID],references:[id])
+courseID Int
+order Int
+name String
+lessons Lesson[]
+}
+
+model Comment {
+id Int @default(autoincrement()) @id
+user User @relation(fields: [userID],references:[id])
+userID Int
+course Course @relation(fields: [courseID],references:[id])
+courseID Int
+title String
+text String
+}
+
+model Lesson {
+id Int @default(autoincrement()) @id
+order Int
+name String
+chapter Chapter @relation(fields: [chapterID],references:[id])
+chapterID Int
+video Video 
+puzzles Puzzle[]
+}
+
+model Video {
+id Int @default(autoincrement()) @id
+vimeoID Int
+duration Float
+lesson Lesson @relation(fields: [lessonID],references:[id])
+lessonID Int
+}
+
+model Puzzle {
+  id Int @default(autoincrement()) @id
+  lesson Lesson @relation(fields: [lessonID],references:[id])
+  lessonID Int
+  description String?
+  fen String
+  moves String[]
+  helps String[]
+}
+
+enum Status {
+BUILDING
+VERIFYING
+PUBLISH
+}
+
+enum Title {
+  GM
+  IM
+  FM
+  WGM
+  WIM
+}
+enum Role {
+  ADMIN
+  USER
+}
+
+
+
+// type Puzzle = {
+// id:ID, 
+// lesson:ID,
+// order:Interger,
+// description:String,
+// fen:String!,
+// moves:[{move:"",comment:""}]!
+// }
+// type Video = {
+// id:ID
+// vimeoID: Integer,
+// lesson:ID
+// }
+
+
+// type Lesson = {
+// id:ID,
+// order:Integer,
+// name:String,
+// chapter:ID, 
+// video:ID
+// puzzles:[Puzzle)]
+// }
+
+// type Chapter = {
+// id:ID,
+// order:Integer, 
+// name:String,
+// lessons:[Lesson],
+// }
+// type Comment = {
+// id:ID,
+// author:User,
+// title:String,
+// text:String,
+// reply: Comment
+// }
+// type Course = {
+// id:ID,
+// name:String,
+// description:String,
+// category:String,
+// level:String, 
+// status:enum["Building","verifying","publish"]
+// author:ID (user),
+// students:[ID], 
+// price:float,
+// priceSale:float,
+// whyChooseCourse:[String],
+// picture:URL,
+// curriculum:[Chapter],
+// averageRating: Integer [0-5],
+// comments:[{comment:String, rating:[0-5]}, reply:String]],
+// totalPurchase: Integer,
+// forSearchEngine: float,
+// createdAt:Date,  
+// totalRevenue:float
+// }
+
+
+
+
+
+// type User =  {
+// id:ID, 
+// name:String,
+// username:String!,
+// email:String!,
+// lichessID:"",
+// googleAuth:"",
+// facebookAuth:"",
+// aboutMe:String,
+// title:enum ["GM","IM","FM", "WGM", "WIM"],
+// myCourses:[Course],
+// boughtCourses:[Course],
+// comments:[],
+// banned:Boolean, 
+// role: enum ["admininstrator","teacher+","teacher","student"]!,
+
+// Student = registed user, Teacher = student + title 
+// Teacher+ = Teacher+"PayPal", Admin=god 
+
+// %: Integer,
+// }
```


