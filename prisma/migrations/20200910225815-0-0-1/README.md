# Migration `20200910225815-0-0-1`

This migration has been generated by Taykavol at 9/11/2020, 1:58:15 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Category" AS ENUM ('Openings', 'Middlegame', 'Endgame', 'Games', 'Basics')

CREATE TYPE "public"."Status" AS ENUM ('BUILDING', 'VERIFYING', 'PUBLISH', 'UNPUBLISH')

CREATE TYPE "public"."Title" AS ENUM ('GM', 'IM', 'FM', 'WGM', 'WIM')

CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'TEACHER', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"role" "Role"  NOT NULL DEFAULT E'USER',
"email" text   ,
"password" text   ,
"lichessId" text   ,
"isBanned" boolean   NOT NULL DEFAULT false,
"courseId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."instructorProfile" (
"id" SERIAL,
"userId" integer   ,
"teacherName" text   ,
"title" "Title"  ,
"videos" text []  ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BoughtCourse" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"courseId" integer   NOT NULL ,
"progress" integer   NOT NULL DEFAULT 2,
"lastSeen" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"review" Decimal(65,30)   ,
"reviewMessage" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Order" (
"id" SERIAL,
"price" Decimal(65,30)   NOT NULL ,
"courseId" integer   NOT NULL ,
"buyerId" integer   NOT NULL ,
"sellerId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Course" (
"id" SERIAL,
"title" text   NOT NULL DEFAULT E'',
"subtitle" text   NOT NULL DEFAULT E'',
"authorId" integer   ,
"description" text   DEFAULT E'',
"category" "Category"  NOT NULL DEFAULT E'Basics',
"level" text   NOT NULL DEFAULT E'1500 2000',
"status" "Status"  DEFAULT E'BUILDING',
"lessons" integer   ,
"duration" integer   ,
"price" Decimal(65,30)   NOT NULL DEFAULT 20,
"averageRating" Decimal(65,30)   NOT NULL DEFAULT 0,
"curriculum" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.lichessId_unique" ON "public"."User"("lichessId")

CREATE UNIQUE INDEX "instructorProfile_userId_unique" ON "public"."instructorProfile"("userId")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."instructorProfile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."BoughtCourse" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BoughtCourse" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("buyerId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("sellerId")REFERENCES "public"."instructorProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Course" ADD FOREIGN KEY ("authorId")REFERENCES "public"."instructorProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200910225815-0-0-1
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,161 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id      Int      @default(autoincrement()) @id
+  role Role @default(USER)
+  email   String?   @unique
+  password String? 
+  lichessId String? @unique
+  boughtCourses BoughtCourse[] 
+  isBanned Boolean @default(false)
+  instructorProfile instructorProfile? 
+}
+model instructorProfile{
+  id Int @default(autoincrement()) @id
+  user User? @relation(fields: [userId],references:[id])
+  userId Int?
+  teacherName String?
+  title Title?
+  myCourses Course[]
+  orders Order[]
+  videos String[]
+  // paypalId String?
+}
+model BoughtCourse {
+  id Int @default(autoincrement()) @id
+  user User @relation(fields: [userId],references:[id])
+  userId Int
+  course Course @relation(fields: [courseId],references:[id])
+  courseId Int
+  progress Int @default(2)
+  lastSeen DateTime @default(now())
+  review Float?
+  reviewMessage String?
+}
+model Order {
+  id Int @default(autoincrement()) @id
+  price Float
+  course Course @relation(fields: [courseId],references:[id])
+  courseId Int
+  buyer User @relation(fields: [buyerId],references:[id])
+  buyerId Int
+  seller instructorProfile @relation(fields: [sellerId],references:[id])
+  sellerId Int
+  createdAt DateTime @default(now())
+
+}
+
+model Course {
+id Int @default(autoincrement()) @id
+title String @default("")
+subtitle String @default("")
+author instructorProfile? @relation(fields: [authorId],references:[id])
+authorId Int?
+description String? @default("")
+category Category @default(Basics)
+level String @default("1500 2000")
+status Status? @default(BUILDING)
+registedStudents User[] 
+lessons Int?
+duration Int?
+price Float @default(20)
+// picture String?
+averageRating Float @default(0)
+curriculum String?
+// totalPurchase Int @default(0)
+// totalRevenue Float @default(0)
+// forSearchEngines Float @default(0)
+createdAt DateTime @default(now()) 
+}
+
+// model Curriculum {
+// id Int @default(autoincrement()) @id
+// course Course? @relation(fields: [courseId],references:[id])
+// courseId Int?
+// chapters Chapter[] 
+// }
+
+// model Chapter {
+// id Int @default(autoincrement()) @id
+// curriculum Curriculum @relation(fields: [curriculumID],references:[id])
+// curriculumID Int
+// order Int
+// name String?
+// lessons Lesson[]
+// }
+
+// model Comment {
+// id Int @default(autoincrement()) @id
+// user User @relation(fields: [userID],references:[id])
+// userID Int
+// course Course @relation(fields: [courseID],references:[id])
+// courseID Int
+// title String
+// text String
+// }
+
+// model Lesson {
+// id Int @default(autoincrement()) @id
+// order Int
+// name String?
+// chapter Chapter @relation(fields: [chapterID],references:[id])
+// chapterID Int
+// video Video?
+// puzzles Puzzle[]
+// }
+
+// model Video {
+// id Int @default(autoincrement()) @id
+// vimeoID Int
+// duration Float
+// lesson Lesson @relation(fields: [lessonID],references:[id])
+// lessonID Int
+// }
+
+// model Puzzle {
+//   id Int @default(autoincrement()) @id
+//   lesson Lesson @relation(fields: [lessonID],references:[id])
+//   lessonID Int
+//   description String?
+//   fen String
+//   moves String[]
+//   helps String[]
+// }
+enum Category {
+  Openings
+  Middlegame
+  Endgame
+  Games
+  Basics
+} 
+enum Status {
+BUILDING
+VERIFYING
+PUBLISH
+UNPUBLISH
+}
+
+enum Title {
+  GM
+  IM
+  FM
+  WGM
+  WIM
+}
+enum Role {
+  ADMIN
+  TEACHER
+  USER
+}
+
+
```


