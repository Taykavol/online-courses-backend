# Migration `20200729212854-again`

This migration has been generated by Taykavol at 7/29/2020, 9:28:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Status" AS ENUM ('BUILDING', 'VERIFYING', 'PUBLISH', 'UNPUBLISH');

CREATE TYPE "Title" AS ENUM ('GM', 'IM', 'FM', 'WGM', 'WIM');

CREATE TYPE "Role" AS ENUM ('ADMIN', 'USER');

CREATE TABLE "public"."User" (
"id" SERIAL,
"role" "Role" NOT NULL DEFAULT E'USER',
"email" text  NOT NULL ,
"password" text   ,
"publicName" text   ,
"lichessID" text   ,
"googleID" text   ,
"facebookID" text   ,
"banned" boolean   DEFAULT false,
PRIMARY KEY ("id"))

CREATE TABLE "public"."instructorProfile" (
"id" SERIAL,
"userID" integer  NOT NULL ,
"teacherName" text   ,
"title" "Title"  ,
"paypalID" text   ,
"bitcoinAdress" text   ,
"income" integer   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Course" (
"id" SERIAL,
"name" text   DEFAULT E'My new course',
"authorID" integer  NOT NULL ,
"description" text   ,
"category" text   ,
"level" text   ,
"status" "Status"  DEFAULT E'BUILDING',
"price" Decimal(65,30)  NOT NULL DEFAULT 9.99,
"priceSale" Decimal(65,30)  NOT NULL DEFAULT 9.99,
"picture" text   ,
"averageRating" Decimal(65,30)  NOT NULL DEFAULT 0,
"totalPurchase" integer  NOT NULL DEFAULT 0,
"totalRevenue" Decimal(65,30)  NOT NULL DEFAULT 0,
"forSearchEngines" Decimal(65,30)  NOT NULL DEFAULT 0,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Curriculum" (
"id" SERIAL,
"courseID" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Chapter" (
"id" SERIAL,
"curriculumID" integer  NOT NULL ,
"order" integer  NOT NULL ,
"name" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"userID" integer  NOT NULL ,
"courseID" integer  NOT NULL ,
"title" text  NOT NULL ,
"text" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Lesson" (
"id" SERIAL,
"order" integer  NOT NULL ,
"name" text   ,
"chapterID" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Video" (
"id" SERIAL,
"vimeoID" integer  NOT NULL ,
"duration" Decimal(65,30)  NOT NULL ,
"lessonID" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Puzzle" (
"id" SERIAL,
"lessonID" integer  NOT NULL ,
"description" text   ,
"fen" text  NOT NULL ,
"moves" text []  ,
"helps" text []  ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_CourseToUser" (
"A" integer  NOT NULL ,
"B" integer  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "instructorProfile_userID" ON "public"."instructorProfile"("userID")

CREATE UNIQUE INDEX "Video_lessonID" ON "public"."Video"("lessonID")

CREATE UNIQUE INDEX "_CourseToUser_AB_unique" ON "public"."_CourseToUser"("A","B")

CREATE  INDEX "_CourseToUser_B_index" ON "public"."_CourseToUser"("B")

ALTER TABLE "public"."instructorProfile" ADD FOREIGN KEY ("userID")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Course" ADD FOREIGN KEY ("authorID")REFERENCES "public"."instructorProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Curriculum" ADD FOREIGN KEY ("courseID")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Chapter" ADD FOREIGN KEY ("curriculumID")REFERENCES "public"."Curriculum"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userID")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("courseID")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Lesson" ADD FOREIGN KEY ("chapterID")REFERENCES "public"."Chapter"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Video" ADD FOREIGN KEY ("lessonID")REFERENCES "public"."Lesson"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Puzzle" ADD FOREIGN KEY ("lessonID")REFERENCES "public"."Lesson"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CourseToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CourseToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200729212732-clear..20200729212854-again
--- datamodel.dml
+++ datamodel.dml
@@ -2,133 +2,133 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
-// model User {
-//   id      Int      @default(autoincrement()) @id
-//   role Role @default(USER)
-//   email   String   @unique
-//   password String?
-//   publicName    String?
-//   lichessID String?
-//   googleID String?
-//   facebookID String?
-//   boughtCourses Course[] @relation(references: [id])
-//   banned Boolean? @default(false)
-//   // posts   Post[]
-//   instructorProfile instructorProfile? 
-// }
-// model instructorProfile{
-// id Int @default(autoincrement()) @id
-// user User @relation(fields: [userID],references:[id])
-// userID Int
-// teacherName String?
-// title Title?
-// myCourses Course[]
-// paypalID String?
-// bitcoinAdress String?
-// income Int?
-// }
+model User {
+  id      Int      @default(autoincrement()) @id
+  role Role @default(USER)
+  email   String   @unique
+  password String?
+  publicName    String?
+  lichessID String?
+  googleID String?
+  facebookID String?
+  boughtCourses Course[] @relation(references: [id])
+  banned Boolean? @default(false)
+  // posts   Post[]
+  instructorProfile instructorProfile? 
+}
+model instructorProfile{
+id Int @default(autoincrement()) @id
+user User @relation(fields: [userID],references:[id])
+userID Int
+teacherName String?
+title Title?
+myCourses Course[]
+paypalID String?
+bitcoinAdress String?
+income Int?
+}
-// model Course {
-// id Int @default(autoincrement()) @id
-// name String? @default("My new course")
-// author instructorProfile @relation(fields: [authorID],references:[id])
-// authorID Int
-// description String?
-// category String?
-// level String?
-// status Status? @default(BUILDING)
-// registedStudents User[] @relation(references: [id])
-// price Float @default(9.99)
-// priceSale Float @default(9.99)
-// picture String?
-// averageRating Float @default(0)
-// // curriculum Curriculum?
-// comments Comment[]
-// totalPurchase Int @default(0)
-// totalRevenue Float @default(0)
-// forSearchEngines Float @default(0)
-// createdAt DateTime @default(now()) 
-// }
+model Course {
+id Int @default(autoincrement()) @id
+name String? @default("My new course")
+author instructorProfile @relation(fields: [authorID],references:[id])
+authorID Int
+description String?
+category String?
+level String?
+status Status? @default(BUILDING)
+registedStudents User[] @relation(references: [id])
+price Float @default(9.99)
+priceSale Float @default(9.99)
+picture String?
+averageRating Float @default(0)
+// curriculum Curriculum?
+comments Comment[]
+totalPurchase Int @default(0)
+totalRevenue Float @default(0)
+forSearchEngines Float @default(0)
+createdAt DateTime @default(now()) 
+}
-// model Curriculum {
-// id Int @default(autoincrement()) @id
-// course Course @relation(fields: [courseID],references:[id])
-// courseID Int
-// chapters Chapter[] 
-// }
+model Curriculum {
+id Int @default(autoincrement()) @id
+course Course @relation(fields: [courseID],references:[id])
+courseID Int
+chapters Chapter[] 
+}
-// model Chapter {
-// id Int @default(autoincrement()) @id
-// curriculum Curriculum @relation(fields: [curriculumID],references:[id])
-// curriculumID Int
-// order Int
-// name String?
-// lessons Lesson[]
-// }
+model Chapter {
+id Int @default(autoincrement()) @id
+curriculum Curriculum @relation(fields: [curriculumID],references:[id])
+curriculumID Int
+order Int
+name String?
+lessons Lesson[]
+}
-// model Comment {
-// id Int @default(autoincrement()) @id
-// user User @relation(fields: [userID],references:[id])
-// userID Int
-// course Course @relation(fields: [courseID],references:[id])
-// courseID Int
-// title String
-// text String
-// }
+model Comment {
+id Int @default(autoincrement()) @id
+user User @relation(fields: [userID],references:[id])
+userID Int
+course Course @relation(fields: [courseID],references:[id])
+courseID Int
+title String
+text String
+}
-// model Lesson {
-// id Int @default(autoincrement()) @id
-// order Int
-// name String?
-// chapter Chapter @relation(fields: [chapterID],references:[id])
-// chapterID Int
-// video Video?
-// puzzles Puzzle[]
-// }
+model Lesson {
+id Int @default(autoincrement()) @id
+order Int
+name String?
+chapter Chapter @relation(fields: [chapterID],references:[id])
+chapterID Int
+video Video?
+puzzles Puzzle[]
+}
-// model Video {
-// id Int @default(autoincrement()) @id
-// vimeoID Int
-// duration Float
-// lesson Lesson @relation(fields: [lessonID],references:[id])
-// lessonID Int
-// }
+model Video {
+id Int @default(autoincrement()) @id
+vimeoID Int
+duration Float
+lesson Lesson @relation(fields: [lessonID],references:[id])
+lessonID Int
+}
-// model Puzzle {
-//   id Int @default(autoincrement()) @id
-//   lesson Lesson @relation(fields: [lessonID],references:[id])
-//   lessonID Int
-//   description String?
-//   fen String
-//   moves String[]
-//   helps String[]
-// }
+model Puzzle {
+  id Int @default(autoincrement()) @id
+  lesson Lesson @relation(fields: [lessonID],references:[id])
+  lessonID Int
+  description String?
+  fen String
+  moves String[]
+  helps String[]
+}
-// enum Status {
-// BUILDING
-// VERIFYING
-// PUBLISH
-// UNPUBLISH
-// }
+enum Status {
+BUILDING
+VERIFYING
+PUBLISH
+UNPUBLISH
+}
-// enum Title {
-//   GM
-//   IM
-//   FM
-//   WGM
-//   WIM
-// }
-// enum Role {
-//   ADMIN
-//   USER
-// }
+enum Title {
+  GM
+  IM
+  FM
+  WGM
+  WIM
+}
+enum Role {
+  ADMIN
+  USER
+}
```


